<!doctype html>
<html>

<head>
    <title>Socket.IO chat</title>
    <link href="http://casamusolino.ddns.net/static/body.css" rel="stylesheet" type="text/css">
</head>

<body>

    <ul id="Users">
    </ul>

    <ul id="messages"></ul>


    <div style="position:fixed ;padding:2px; bottom: 4%; right:0; height:100; border:2px solid #000;">
<b>Username:</b>
<input id="username" type="text" name="Username" maxlength="25" value="Ghost">
</div>

<form id="formTo" action="">
    <input id="m" autocomplete="off" /><button>Send</button>
</form>

<script>
    function appendMessage(mess) {
        $("#messages").append($("<li>").text(mess));
    }
    function appendLog(log) {
        $("#messages").append($("<li>").html("<b>" + log + "</b>"));
    }
    function getUsername() {
        return $("#username").val();
    }
    function addUser(username, socketID) {
        $("#Users").append('<li id="' + socketID + '">'+username+'</li>');
    }
    function removeUser(socketID) {
        $('#' + socketID).remove();
    }
    function getNameOfID(id)
    {
        return $('#' + id).text();
    }
    function update(socketID,username)
    {
        if (getNameOfID(socketID) !== username)
        {
            removeUser(socketID);
            addUser(username,socketID);
        }
    }
</script>

<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script>
    var socket = io({transports: ["websocket"]});
    


    $('#formTo').submit(function () {
        socket.emit('chat message', $('#m').val(), getUsername());
        update(socket.id, getUsername());
        appendMessage("You: " + $('#m').val());
        $('#m').val('');
        return false;
    });

    socket.on('log', function(mex){
        console.log(mex);
    });

    socket.on("get users connected", function(userID)
    {
        for (id in userID)
        {
            addUser(userID[id], id);
        }
    });

    socket.on("new user connected", function (name, id) {
        appendLog(name + " has connected");
        addUser(name, id);
    });
    socket.on("chat message", function (mes, username, socketID) {
        appendMessage(username + ": " + mes);
        update(socketID,username);
    });
    socket.on("user disconnected", function (id) {
        appendLog(getNameOfID(id) + " has disconnected");
        removeUser(id);
    });

</script>
</body>

</html>